(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(a){if(a.ep)return;a.ep=!0;const s=e(a);fetch(a.href,s)}})();function y(){const t=new Set;return{subscribe:n=>(t.add(n),()=>t.delete(n)),notify:n=>{t.forEach(e=>e(n))}}}function F(){const t={currentPage:1,itemsPerPage:4},n=y();return{getState:()=>({...t}),subscribe:n.subscribe,setPage:e=>{typeof e=="number"&&e>=1&&(t.currentPage=e,n.notify())},reset:()=>{t.currentPage!==1&&(t.currentPage=1,n.notify())},forceUpdate:e=>{n.notify(e)}}}function w(){let t={},n=[];const e=a(),r=y();function a(){const o=localStorage.getItem("favoriteCharacterIds");return o?new Set(JSON.parse(o)):new Set}function s(){localStorage.setItem("favoriteCharacterIds",JSON.stringify(Array.from(e))),r.notify()}return{getCharacter:o=>t[o],getLastRandom:()=>[...n],isFavorite:o=>e.has(o),getFavoriteIds:()=>Array.from(e),subscribe:r.subscribe,addCharacters:o=>{(Array.isArray(o)?o:[o]).forEach(i=>{i&&i.id&&(t[i.id]=i)})},setLastRandom:o=>{n=o||[],r.notify()},addFavorite:o=>{o&&!e.has(o)&&(e.add(o),s())},removeFavorite:o=>{o&&e.has(o)&&(e.delete(o),s())}}}const u=F(),m=w();function S(t=20,n=826){const e=new Set;for(;e.size<t;)e.add(Math.floor(Math.random()*n)+1);return Array.from(e)}async function L(t=!1){const n=m.getLastRandom();if(!t&&n.length>0)return n;const e=S().join(",");let r;try{const s=await fetch(`https://rickandmortyapi.com/api/character/${e}`);if(!s.ok)throw new Error(`API error: ${s.status}`);r=await s.json()}catch(s){return console.error("Couldn't load characters",s),[]}const a=Array.isArray(r)?r:[r];return m.addCharacters(a),m.setLastRandom(a),a}function P(t){t&&(m.isFavorite(t)?m.removeFavorite(t):m.addFavorite(t))}async function I(){const t=m.getFavoriteIds();if(t.length===0)return[];const n=t.filter(e=>!m.getCharacter(e));if(n.length>0)try{const r=await(await fetch(`https://rickandmortyapi.com/api/character/${n.join(",")}`)).json(),a=Array.isArray(r)?r:[r];m.addCharacters(a)}catch(e){console.error("Could not fetch favorite characters:",e)}return t.map(e=>m.getCharacter(e)).filter(Boolean)}function N(){let t=[],n=[],e={gender:"",status:"",name:""};function r(){if(t.length===0){n=[];return}n=t.filter(i=>(!e.gender||i.gender===e.gender)&&(!e.status||i.status===e.status)&&(!e.name||i.name.toLowerCase().includes(e.name.toLowerCase())))}function a(i){t=i||[],r()}function s(i){e={...e,...i},r(),u.getState().currentPage!==1||u.forceUpdate({type:"FILTER_UPDATE"}),u.reset()}function o(){const{currentPage:i,itemsPerPage:c}=u.getState(),d=(i-1)*c,p=d+c;return n.slice(d,p)}function l(){return n.length}return{setCharacters:a,updateFilters:s,getPaginatedItems:o,getFilteredCount:l}}async function x(t){if(!t.episode||t.episode.length===0)return[];const n=t.episode.map(e=>e.split("/").pop()).join(",");try{const e=await fetch(`https://rickandmortyapi.com/api/episode/${n}`);if(!e.ok)return[];const r=await e.json();return Array.isArray(r)?r:[r]}catch(e){return console.error("Failed to fetch episodes:",e),[]}}function A(){let t={displayMode:"list",activeCharacterId:null,listSource:"newCharacters",isLoading:!0};const n=N(),e={handleFilterChange:a=>{n.updateFilters(a)},handleFavoriteToggle:a=>{P(a)},handleViewChange:a=>{t.listSource!==a&&u.reset(),t.displayMode="list",t.listSource=a,e.loadCharactersForView()},handleCharacterSelect:a=>{t.activeCharacterId=a,t.displayMode="details",u.forceUpdate()},handleBackFromDetails:()=>{t.activeCharacterId=null,t.displayMode="list",u.forceUpdate()},loadCharactersForView:async()=>{t.isLoading=!0,u.forceUpdate();let a=[];switch(t.listSource){case"characters":case"newCharacters":a=await L(t.listSource==="newCharacters");break;case"favorites":a=await I();break;default:a=[]}n.setCharacters(a),t.isLoading=!1,u.forceUpdate()}};return{actions:e,selectors:{getPaginatedCharacters:()=>n.getPaginatedItems(),getTotalFilteredCount:()=>n.getFilteredCount(),getState:()=>({...t})},characterManager:n}}const M="/RickMortyChallenge/assets/effect-BNDgtSXq.webp",v=t=>{const n=document.createElement("select");return t.forEach(({value:e,label:r})=>{const a=document.createElement("option");a.value=e,a.textContent=r,n.appendChild(a)}),n};function k({onFilterChange:t}){const n=[{value:"",label:"Any Gender"},{value:"Male",label:"Male"},{value:"Female",label:"Female"},{value:"Genderless",label:"Genderless"},{value:"unknown",label:"Unknown"}],e=[{value:"",label:"Any"},{value:"Alive",label:"Alive"},{value:"Dead",label:"Dead"},{value:"unknown",label:"Unknown"}],r=document.createElement("div");r.className="filterContainer";const a=document.createElement("div");a.className="filterPanel";const s=document.createElement("img");s.className="filterEffect",s.src=M;const o=v(n),l=v(e),i=document.createElement("input");i.type="text",i.placeholder="Search by name...",i.className="filterSearch";const c=document.createElement("button");c.textContent="X",c.className="reset-btn";function d(){t({gender:o.value,status:l.value,name:i.value.trim().toLowerCase()})}return l.addEventListener("change",d),o.addEventListener("change",d),i.addEventListener("input",d),c.addEventListener("click",()=>{o.selectedIndex=l.selectedIndex=0,i.value="",d()}),a.append(i,o,l,c),r.append(s,a),r}function T({image:t,name:n,id:e,status:r,species:a,isFavorite:s,onCharacterSelect:o,onFavoriteToggle:l}){const i=document.createElement("div");i.className="characterItem",i.dataset.characterId=e,i.addEventListener("click",()=>o(e));const c=document.createElement("img");c.src=t,c.alt=n||"Image";const d=document.createElement("button");d.className="favButton",d.addEventListener("click",h=>{h.stopPropagation(),l(e)});const p=document.createElement("p");p.textContent=n;const f=document.createElement("p");f.textContent=`Status: ${r}`;const g=document.createElement("p");g.textContent=`Species: ${a}`;const C=document.createElement("div");C.className="cardTextContent",C.append(p,f,g),i.append(d,c,C);function b({isFavorite:h}){d.textContent==="★"!==h&&(d.textContent=h?"★":"☆")}return d.textContent=s?"★":"☆",{element:i,update:b}}function B({onCharacterSelect:t,onFavoriteToggle:n}){const e=new Map,r=document.createElement("div");r.className="characterGrid";function a(s){if(!s||s.length===0){r.innerHTML="<p class='isEmpty'>No characters found...</p>",e.clear();return}const o=new Set(s.map(c=>c.id));for(const[c,d]of e.entries())o.has(c)||(d.element.remove(),e.delete(c));const l=document.createDocumentFragment();s.forEach(c=>{if(e.has(c.id))e.get(c.id).update({isFavorite:m.isFavorite(c.id)});else{const d=T({image:c.image,name:c.name,id:c.id,status:c.status,species:c.species,isFavorite:m.isFavorite(c.id),onCharacterSelect:t,onFavoriteToggle:n});e.set(c.id,d),l.appendChild(d.element)}}),l.children.length>0&&r.appendChild(l);const i=s.map(c=>e.get(c.id).element);r.replaceChildren(...i)}return{element:r,display:a}}function $(){const t=document.createElement("div");t.className="gridControls";const n=document.createElement("button"),e=document.createElement("button"),r=document.createElement("span");let a=1;n.textContent="← Prev",e.textContent="Next →";function s(){const{currentPage:l}=u.getState();r.textContent=`${l}/${a}`,n.disabled=l<=1,e.disabled=l>=a}function o(l){a=Math.max(1,Math.ceil(l/u.getState().itemsPerPage)),s()}return n.addEventListener("click",()=>{let l=u.getState().currentPage;u.setPage(--l)}),e.addEventListener("click",()=>{let l=u.getState().currentPage;u.setPage(++l)}),t.append(n,r,e),{element:t,update:o}}function D({onCharacterSelect:t,onFavoriteToggle:n}){const e=document.createElement("div");e.className="characterContainer";const r=B({onCharacterSelect:t,onFavoriteToggle:n}),a=$();function s(l){r.display(l)}function o(l){a.update(l)}return e.append(r.element,a.element),{container:e,displayCharacters:s,updateControls:o}}function O({character:t,episodes:n,onBack:e}){const r=document.createElement("div");r.className="characterDetailsContainer";const a=document.createElement("button");a.textContent="← Back",a.addEventListener("click",e);const s=document.createElement("div");s.className="detailsContent";const o=document.createElement("img");o.src=t.image,o.alt=t.name;const l=document.createElement("div");l.className="detailsText",l.innerHTML=`
    <h2>${t.name}</h2>
    <p>Status: ${t.status}</p>
    <p>Species: ${t.species}</p>
    <p>Gender: ${t.gender}</p>
    <p>Origin: ${t.origin.name}</p>
    <p><strong>Location:</strong> ${t.location.name}</p>
    <h3>Episodes:</h3>
  `;const i=document.createElement("ul");return n.forEach(c=>{const d=document.createElement("li");d.textContent=`${c.name} (${c.episode})`,i.appendChild(d)}),l.appendChild(i),s.append(o,l),r.append(a,s),r}function R({onViewChange:t}){const n=document.createElement("div");n.className="viewControls";const e=document.createElement("button");e.textContent="Load Random Characters";const r=document.createElement("button");return r.textContent="Show Favorites",e.addEventListener("click",()=>{r.disabled?(r.disabled=!1,e.textContent="Load Random Characters",t("characters")):t("newCharacters")}),r.addEventListener("click",()=>{t("favorites"),r.disabled=!0,e.textContent="Confirm & return"}),n.append(e,r),n}function H(){const{actions:t,selectors:n}=A(),e=document.createElement("div");e.className="homeContainer";const r=document.createElement("H1");r.textContent="Loading...",r.className="loading";const a=k({onFilterChange:t.handleFilterChange}),s=R({onViewChange:t.handleViewChange}),o=D({onCharacterSelect:t.handleCharacterSelect,onFavoriteToggle:t.handleFavoriteToggle});function l(){const c=n.getPaginatedCharacters();o.displayCharacters(c);const d=n.getTotalFilteredCount();o.updateControls(d)}async function i(c){if(c&&c.type==="FILTER_UPDATE"){l();return}e.innerHTML="";const d=n.getState();if(d.isLoading){e.append(r);return}if(d.displayMode==="details"){const p=m.getCharacter(d.activeCharacterId);if(p){const f=await x(p),g=O({character:p,episodes:f,onBack:t.handleBackFromDetails});e.append(g)}else e.innerHTML='<p>Character not found. <button id="back-btn">Back</button></p>',e.querySelector("#back-btn").onclick=t.handleBackFromDetails}else{const p=n.getPaginatedCharacters();o.displayCharacters(p);const f=n.getTotalFilteredCount();o.updateControls(f),e.append(o.container,a,s)}}return m.subscribe(i),u.subscribe(i),t.loadCharactersForView(),e}function U(){const t=document.createElement("div");return t.className="about",t.innerHTML=`
    <h1>About</h1>
    <p>By Merlu & Around enough mate to consider visiting a doctor.</p>
  `,t}const G={"/":H,"/about":U};function E(){const t=location.hash.slice(1)||"/",n=G[t]||(()=>{const a=document.createElement("div");return a.innerHTML="<h1>Page  Not Found</h1>",a}),e=document.getElementById("app");e.innerHTML="";const r=n();e.appendChild(r)}window.addEventListener("hashchange",E);window.addEventListener("DOMContentLoaded",E);
