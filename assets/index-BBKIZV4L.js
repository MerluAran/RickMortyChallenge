(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();function y(){const t=new Set;return{subscribe:a=>(t.add(a),()=>t.delete(a)),notify:()=>{t.forEach(a=>a())}}}function F(){const t={currentPage:1,itemsPerPage:4},a=y();return{getState:()=>({...t}),subscribe:a.subscribe,setPage:e=>{typeof e=="number"&&e>=1&&(t.currentPage=e,a.notify())},reset:()=>{t.currentPage!==1&&(t.currentPage=1),a.notify()},forceUpdate:()=>{a.notify()}}}function w(){let t={},a=[];const e=n(),r=y();function n(){const o=localStorage.getItem("favoriteCharacterIds");return o?new Set(JSON.parse(o)):new Set}function s(){localStorage.setItem("favoriteCharacterIds",JSON.stringify(Array.from(e))),r.notify()}return{getCharacter:o=>t[o],getLastRandom:()=>[...a],isFavorite:o=>e.has(o),getFavoriteIds:()=>Array.from(e),subscribe:r.subscribe,addCharacters:o=>{(Array.isArray(o)?o:[o]).forEach(l=>{l&&l.id&&(t[l.id]=l)})},setLastRandom:o=>{a=o||[],r.notify()},addFavorite:o=>{o&&!e.has(o)&&(e.add(o),s())},removeFavorite:o=>{o&&e.has(o)&&(e.delete(o),s())}}}const u=F(),m=w();function S(t=20,a=826){const e=new Set;for(;e.size<t;)e.add(Math.floor(Math.random()*a)+1);return Array.from(e)}async function L(t=!1){const a=m.getLastRandom();if(!t&&a.length>0)return a;const e=S().join(",");let r;try{const s=await fetch(`https://rickandmortyapi.com/api/character/${e}`);if(!s.ok)throw new Error(`API error: ${s.status}`);r=await s.json()}catch(s){return console.error("Couldn't load characters",s),[]}const n=Array.isArray(r)?r:[r];return m.addCharacters(n),m.setLastRandom(n),n}function P(t){t&&(m.isFavorite(t)?m.removeFavorite(t):m.addFavorite(t))}async function I(){const t=m.getFavoriteIds();if(t.length===0)return[];const a=t.filter(e=>!m.getCharacter(e));if(a.length>0)try{const r=await(await fetch(`https://rickandmortyapi.com/api/character/${a.join(",")}`)).json(),n=Array.isArray(r)?r:[r];m.addCharacters(n)}catch(e){console.error("Could not fetch favorite characters:",e)}return t.map(e=>m.getCharacter(e)).filter(Boolean)}function x(){let t=[],a=[],e={gender:"",status:"",name:""};function r(){if(t.length===0){a=[];return}a=t.filter(l=>(!e.gender||l.gender===e.gender)&&(!e.status||l.status===e.status)&&(!e.name||l.name.toLowerCase().includes(e.name.toLowerCase())))}function n(l){t=l||[],r()}function s(l){e={...e,...l},r(),u.reset()}function o(){const{currentPage:l,itemsPerPage:i}=u.getState(),d=(l-1)*i,p=d+i;return a.slice(d,p)}function c(){return a.length}return{setCharacters:n,updateFilters:s,getPaginatedItems:o,getFilteredCount:c}}function N(){let t={displayMode:"list",activeCharacterId:null,listSource:"newCharacters",isLoading:!0};const a=x(),e={handleFilterChange:n=>{a.updateFilters(n)},handleFavoriteToggle:n=>{P(n)},handleViewChange:n=>{t.listSource!==n&&u.reset(),t.displayMode="list",t.listSource=n,e.loadCharactersForView()},handleCharacterSelect:n=>{t.activeCharacterId=n,t.displayMode="details",u.forceUpdate()},handleBackFromDetails:()=>{t.activeCharacterId=null,t.displayMode="list",u.forceUpdate()},loadCharactersForView:async()=>{t.isLoading=!0,u.forceUpdate();let n=[];switch(t.listSource){case"characters":case"newCharacters":n=await L(t.listSource==="newCharacters");break;case"favorites":n=await I();break;default:n=[]}a.setCharacters(n),t.isLoading=!1,u.forceUpdate()}};return{actions:e,selectors:{getPaginatedCharacters:()=>a.getPaginatedItems(),getTotalFilteredCount:()=>a.getFilteredCount(),getState:()=>({...t})},characterManager:a}}const v=t=>{const a=document.createElement("select");return t.forEach(({value:e,label:r})=>{const n=document.createElement("option");n.value=e,n.textContent=r,a.appendChild(n)}),a};function M({onFilterChange:t}){const a=[{value:"",label:"Any Gender"},{value:"Male",label:"Male"},{value:"Female",label:"Female"},{value:"Genderless",label:"Genderless"},{value:"unknown",label:"Unknown"}],e=[{value:"",label:"Any"},{value:"Alive",label:"Alive"},{value:"Dead",label:"Dead"},{value:"unknown",label:"Unknown"}],r=document.createElement("div");r.className="filterPanel",console.log("Testing");const n=v(a),s=v(e),o=document.createElement("input");o.type="text",o.placeholder="Search by name...",o.className="filterSearch";const c=document.createElement("button");c.textContent="X",c.className="reset-btn";function l(){t({gender:n.value,status:s.value,name:o.value.trim().toLowerCase()})}return s.addEventListener("change",l),n.addEventListener("change",l),o.addEventListener("input",l),c.addEventListener("click",()=>{n.selectedIndex=s.selectedIndex=0,o.value="",l()}),r.append(o,n,s,c),r}function k({image:t,name:a,id:e,status:r,species:n,isFavorite:s,onCharacterSelect:o,onFavoriteToggle:c}){const l=document.createElement("div");l.className="characterItem",l.dataset.characterId=e;const i=document.createElement("img");i.src=t,i.alt=a||"Image",i.addEventListener("click",()=>o(e));const d=document.createElement("button");d.className="favButton",d.addEventListener("click",f=>{f.stopPropagation(),c(e)});const p=document.createElement("p");p.textContent=a;const h=document.createElement("p");h.textContent=`Status: ${r}`;const C=document.createElement("p");C.textContent=`Species: ${n}`;const g=document.createElement("div");g.className="cardTextContent",g.append(p,h,C),l.append(d,i,g);function E({isFavorite:f}){d.textContent==="★"!==f&&(d.textContent=f?"★":"☆")}return d.textContent=s?"★":"☆",{element:l,update:E}}function A({onCharacterSelect:t,onFavoriteToggle:a}){const e=new Map,r=document.createElement("div");r.className="characterGrid";function n(s){if(!s||s.length===0){r.innerHTML="<p class='isEmpty'>No characters found...</p>",e.clear();return}const o=new Set(s.map(i=>i.id));for(const[i,d]of e.entries())o.has(i)||(d.element.remove(),e.delete(i));const c=document.createDocumentFragment();s.forEach(i=>{if(e.has(i.id))e.get(i.id).update({isFavorite:m.isFavorite(i.id)});else{const d=k({image:i.image,name:i.name,id:i.id,status:i.status,species:i.species,isFavorite:m.isFavorite(i.id),onCharacterSelect:t,onFavoriteToggle:a});e.set(i.id,d),c.appendChild(d.element)}}),c.children.length>0&&r.appendChild(c);const l=s.map(i=>e.get(i.id).element);r.replaceChildren(...l)}return{element:r,display:n}}function B(){const t=document.createElement("div");t.className="gridControls";const a=document.createElement("button"),e=document.createElement("button"),r=document.createElement("span");let n=1;a.textContent="← Prev",e.textContent="Next →";function s(){const{currentPage:c}=u.getState();r.textContent=`${c}/${n}`,a.disabled=c<=1,e.disabled=c>=n}function o(c){n=Math.max(1,Math.ceil(c/u.getState().itemsPerPage)),s()}return a.addEventListener("click",()=>{let c=u.getState().currentPage;u.setPage(--c)}),e.addEventListener("click",()=>{let c=u.getState().currentPage;u.setPage(++c)}),t.append(a,r,e),{element:t,update:o}}function T({onCharacterSelect:t,onFavoriteToggle:a}){const e=document.createElement("div");e.className="characterContainer";const r=A({onCharacterSelect:t,onFavoriteToggle:a}),n=B();function s(c){r.display(c)}function o(c){n.update(c)}return e.append(r.element,n.element),{container:e,displayCharacters:s,updateControls:o}}function $({character:t,episodes:a,onBack:e}){const r=document.createElement("div");r.className="characterDetailsContainer";const n=document.createElement("button");n.textContent="← Back",n.addEventListener("click",e);const s=document.createElement("div");s.className="detailsContent";const o=document.createElement("img");o.src=t.image,o.alt=t.name;const c=document.createElement("div");c.className="detailsText",c.innerHTML=`
    <h2>${t.name}</h2>
    <p>Status: ${t.status}</p>
    <p>Species: ${t.species}</p>
    <p>Gender: ${t.gender}</p>
    <p>Origin: ${t.origin.name}</p>
    <p><strong>Location:</strong> ${t.location.name}</p>
    <h3>Episodes:</h3>
  `;const l=document.createElement("ul");return a.forEach(i=>{const d=document.createElement("li");d.textContent=`${i.name} (${i.episode})`,l.appendChild(d)}),c.appendChild(l),s.append(o,c),r.append(n,s),r}function O({onViewChange:t}){const a=document.createElement("div");a.className="viewControls";const e=document.createElement("button");e.textContent="Load Random Characters";const r=document.createElement("button");return r.textContent="Show Favorites",e.addEventListener("click",()=>{r.disabled?(r.disabled=!1,e.textContent="Load Random Characters",t("characters")):t("newCharacters")}),r.addEventListener("click",()=>{t("favorites"),r.disabled=!0,e.textContent="Confirm & return"}),a.append(e,r),a}async function D(t){if(!t.episode||t.episode.length===0)return[];const a=t.episode.map(e=>e.split("/").pop()).join(",");try{const e=await fetch(`https://rickandmortyapi.com/api/episode/${a}`);if(!e.ok)return[];const r=await e.json();return Array.isArray(r)?r:[r]}catch(e){return console.error("Failed to fetch episodes:",e),[]}}function H(){const{actions:t,selectors:a}=N(),e=document.createElement("div");e.className="homeContainer";const r=document.createElement("H1");r.textContent="Loading...",r.className="loading";const n=M({onFilterChange:t.handleFilterChange}),s=O({onViewChange:t.handleViewChange}),o=T({onCharacterSelect:t.handleCharacterSelect,onFavoriteToggle:t.handleFavoriteToggle});async function c(){e.innerHTML="";const l=a.getState();if(l.isLoading){e.append(r);return}if(l.displayMode==="details"){const i=m.getCharacter(l.activeCharacterId);if(i){const d=await D(i),p=$({character:i,episodes:d,onBack:t.handleBackFromDetails});e.append(p)}else e.innerHTML='<p>Character not found. <button id="back-btn">Back</button></p>',e.querySelector("#back-btn").onclick=t.handleBackFromDetails}else{const i=a.getPaginatedCharacters();o.displayCharacters(i);const d=a.getTotalFilteredCount();o.updateControls(d),e.append(s,n,o.container)}}return m.subscribe(c),u.subscribe(c),t.loadCharactersForView(),e}function R(){const t=document.createElement("div");return t.className="about",t.innerHTML=`
    <h1>About</h1>
    <p>By Merlu & Around enough mate to consider visiting a doctor.</p>
  `,t}const G={"/":H,"/about":R};function b(){const t=location.hash.slice(1)||"/",a=G[t]||(()=>{const n=document.createElement("div");return n.innerHTML="<h1>Page  Not Found</h1>",n}),e=document.getElementById("app");e.innerHTML="";const r=a();e.appendChild(r)}window.addEventListener("hashchange",b);window.addEventListener("DOMContentLoaded",b);
